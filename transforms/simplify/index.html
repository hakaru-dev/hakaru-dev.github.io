<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Hakaru Team">
        
        <link rel="shortcut icon" href="favicon.ico">
        

	<title>Simplify - Hakaru</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/base.css" rel="stylesheet">
        <link href="../../logo.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../..">Hakaru</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="../..">Home</a>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Introduction <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../../intro/probprog/">What is Probabilistic Programming?</a>
</li>

                    
                        
<li >
    <a href="../../intro/installation/">Installing Hakaru</a>
</li>

                    
                        
<li >
    <a href="../../intro/samplegen/">Generating Samples from your Hakaru Program</a>
</li>

                    
                        
<li >
    <a href="../../intro/quickstart/">Quick Start: A Mixture Model Example</a>
</li>

                    
                        
<li >
    <a href="../../examples/">Examples</a>
</li>

                    
                        
<li >
    <a href="../compile/">Compiling to Haskell</a>
</li>

                    
                        
<li >
    <a href="../hkc/">Compiling to C</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Language Guide <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../../lang/rand/">Primitive Probability Distributions</a>
</li>

                    
                        
<li >
    <a href="../../lang/letbind/">Let and Bind</a>
</li>

                    
                        
<li >
    <a href="../../lang/cond/">Conditionals</a>
</li>

                    
                        
<li >
    <a href="../../lang/functions/">Functions</a>
</li>

                    
                        
<li >
    <a href="../../lang/coercions/">Types and Coercions</a>
</li>

                    
                        
<li >
    <a href="../../lang/datatypes/">Data Types and Match</a>
</li>

                    
                        
<li >
    <a href="../../lang/arrays/">Arrays and Plate</a>
</li>

                    
                        
<li >
    <a href="../../lang/loops/">Loops</a>
</li>

                    
                        
<li >
    <a href="../expect/">Expect</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Transformations <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../normalize/">Normalize</a>
</li>

                    
                        
<li >
    <a href="../disintegrate/">Disintegrate</a>
</li>

                    
                        
<li >
    <a href="../density/">Density</a>
</li>

                    
                        
<li class="active">
    <a href="./">Simplify</a>
</li>

                    
                        
<li >
    <a href="../mh/">Metropolis Hastings</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Internals <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../../internals/ast/">AST and Hakaru Datakind</a>
</li>

                    
                        
<li >
    <a href="../../internals/abt/">ABT</a>
</li>

                    
                        
<li >
    <a href="../../internals/datums/">Datums</a>
</li>

                    
                        
<li >
    <a href="../../internals/coercions/">Coercions</a>
</li>

                    
                        
<li >
    <a href="../../internals/transforms/">Transformaitons</a>
</li>

                    
                        
<li >
    <a href="../../internals/testing/">Testing</a>
</li>

                    
                        
<li >
    <a href="../../internals/newfeature/">Adding a Language Feature</a>
</li>

                    
                    </ul>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                <li >
                    <a rel="next" href="../density/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../mh/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                <li>
                    <a href="https://github.com/hakaru-dev/hakaru">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#hakaru-maple">Hakaru-Maple</a></li>
        
            <li><a href="#subcommands">Subcommands</a></li>
        
            <li><a href="#example">Example</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="hakaru-maple">Hakaru-Maple</h1>
<p>Hakaru uses the computer algebra system Maple to aid in performing program
transformations. You can use this functionality of Hakaru if you have Maple
installed locally or can access Maple remotely. </p>
<p>Maple can be accessed through the module <code>Language.Hakaru.Maple</code> or through the
Hakaru program <code>hk-maple</code>.</p>
<p>The <code>hk-maple</code> command invokes a Maple command on a Hakaru program. Given a
Hakaru program in concrete syntax and a Maple-Hakaru command, typecheck the
program invoke the Maple command on the program and its type pretty print, parse
and typecheck the program resulting from Maple. See the <code>--help</code> flag of
<code>hk-maple</code> for more information.</p>
<p>The currently available Maple-Hakaru commands (also called subcommands):</p>
<ul>
<li>Simplify </li>
<li>Disintegrate </li>
<li>Summarize </li>
</ul>
<p>Note: calls to Maple may take a very long time. To see if your program is taking
an appreciable amount of time to parse and typecheck, use the <code>--debug</code> flag.</p>
<h2 id="subcommands">Subcommands</h2>
<h3 id="simplify">Simplify</h3>
<p>Hakaru programs are interpreted by Maple as linear operators. In this
interpretation, many commonly understood (by Maple) and powerful tools for
simplification become available. The metric for simplification as understood by
this command is sampling efficiency. <code>Simplify</code> attempts to be as conservative
as possible in changing the given program. In particular, it should not change
terms unless an improvement with respect to sampling is performed; in this case,
arbitrary rearrangement may happen, even if an expression more similair to the
original could be produced.</p>
<p><code>Simplify</code> is the default subcommand.</p>
<p><code>Simplify</code> preserves the semantics of the given program up to normalization of
weights. If the stronger sense of equivalence is needed, the output of
<code>Simplify</code> can be passed to <code>normalize</code>. </p>
<h3 id="disintegrate">Disintegrate</h3>
<p>The Maple disintegrator is an alternative implementation of the program
transformation described in [Disintegrate]. Semantically, the Maple
disintegrator and Haskell disintegrator implement the same transformation. In
particular, their outputs are not (often) identical, but have equivalent
sampling semantics. In practice, the ouputs may differ, since one may fail where
the other succeeds. </p>
<p>If in doubt about which disintegrator to use, consider the following order:</p>
<ol>
<li><code>disintegrate x</code></li>
<li><code>disintegrate x | hk-maple -</code></li>
<li><code>hk-maple --command disintegrate x</code></li>
<li><code>hk-maple x | disintegrate -</code> </li>
<li>etc&hellip;</li>
</ol>
<p>All of the above programs should be equivalent as samplers. </p>
<p>The disintegrator internally relies heavily on the <code>Simplify</code> command, so if the
given problem is an easy disintegration problem but a difficult simplification
problem, it is preferred to use the Haskell disintegrator followed by a call
to <code>Simplify</code>.</p>
<p>The chance that the Maple disintegrator produces a good program (or any program
at all) is proportional to the type of program it is given. In addition to
programs whose disintegration by Haskell is not efficient as a sampler, the
following programs are good candidates:</p>
<ul>
<li>programs which contain superpositions with complicated conditions</li>
<li>programs which contain complicated rational polynomials </li>
</ul>
<p>The Maple disintegrator follows the same conventions as the Haskell
disintegrator.</p>
<p>Like <code>Simplify</code>, <code>Disintegrate</code> preserves the semantics of the given program only up to
normalization of weights.</p>
<h3 id="summarize">Summarize</h3>
<p>?</p>
<h2 id="example">Example</h2>
<p>This program takes in a value of type <code>prob</code> and returns a measure of type <code>real</code>:</p>
<pre><code class="nohighlight">fn a prob:
  x &lt;~ normal(a,1)
  y &lt;~ normal(x,1)
  z &lt;~ normal(y,1)
  return z
</code></pre>

<p>The returned value, <code>z</code>, is generated by passing the last value generated by the function, starting with the original function argument. This indicates that it might be 
reducible to a smaller program. Assuming that we named the program <code>simplify_before.hk</code>, we can call the <code>simplify</code> transform by running:</p>
<pre><code class="bash">simplify simplify_before.hk
</code></pre>

<p><strong>Note:</strong> The output for <code>simplify</code> will be printed in the console. You can easily save this program to a file by redirecting the output to a file by calling 
<code>simplify model1.hk &gt; model2.hk</code>. For this example, we will call our new program <code>simplify_after.hk</code>. </p>
<p>When you open our new program, <code>simplify_after.hk</code>, you will see that the original five-line program has been reduced to a single line:</p>
<pre><code class="nohighlight">fn a prob: normal(prob2real(a), sqrt(3))
</code></pre></div>
        </div>

        <footer class="col-md-12">
            <hr>
            
            <center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
        </footer>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>
        <script src="../../js/mathjaxhelper.js"></script>
        <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>